# Validation LSMTool parset
# Run with "lsmtool.py tests/no_patches.sky parsets/validation.parset"

LSMTool.Steps = [select, transfer, remove, ungroup, group, move, merge, concatenate, add, plot]

# Select individual sources with Stokes I fluxes above 1 Jy
LSMTool.Steps.select.Operation = SELECT
LSMTool.Steps.select.FilterExpression = I > 1.0 Jy

# Transfer patches from test2.sky
LSMTool.Steps.transfer.Operation = TRANSFER
LSMTool.Steps.transfer.PatchFile = tests/patches.sky

# Remove patches with total fluxes below 2 Jy
LSMTool.Steps.remove.Operation = REMOVE
LSMTool.Steps.remove.FilterExpression = I < 2.0 Jy
LSMTool.Steps.remove.Aggregate = True

# Remove all patches
LSMTool.Steps.ungroup.Operation = UNGROUP

# Group using tessellation to a target flux of 50 Jy
LSMTool.Steps.group.Operation = GROUP
LSMTool.Steps.group.Algorithm = tessellate
LSMTool.Steps.group.TargetFlux = 50.0 Jy
LSMTool.Steps.group.Method = mid

# Move patch 'bin1' by 0.001 degrees in RA
LSMTool.Steps.move.Operation = MOVE
LSMTool.Steps.move.Name = bin1
LSMTool.Steps.move.Shift = [0.001, 0.0]

# Merge patches 'bin0' and 'bin2'
LSMTool.Steps.merge.Operation = MERGE
LSMTool.Steps.merge.Patches = [bin0, bin2]
LSMTool.Steps.merge.Name = merged_patch

# Concatenate with concat_sky_model.sky
LSMTool.Steps.concatenate.Operation = CONCATENATE
LSMTool.Steps.concatenate.Skymodel2 = tests/patches.sky
LSMTool.Steps.concatenate.MatchBy = position
LSMTool.Steps.concatenate.Radius = 30 arcsec
LSMTool.Steps.concatenate.Keep = from2

# Add a source and write final sky model
LSMTool.Steps.add.Operation = ADD
LSMTool.Steps.add.Name = src1
LSMTool.Steps.add.Type = POINT
LSMTool.Steps.add.Patch = src1_patch
LSMTool.Steps.add.Ra = 277.4232
LSMTool.Steps.add.Dec = 48.3689
LSMTool.Steps.add.I = 0.69
LSMTool.Steps.add.OutFile = tests/test_final.sky

# Plot the sky model
LSMTool.Steps.plot.Operation = PLOT
LSMTool.Steps.plot.OutFile = tests/test_plot.pdf
